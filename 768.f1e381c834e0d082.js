"use strict";(self.webpackChunkicall=self.webpackChunkicall||[]).push([[768],{6768:(Z,I,a)=>{a.r(I),a.d(I,{LoginModule:()=>d});var P=a(6895),O=a(5861),g=a(4006),n=a(4650),y=a(1135),b=a(5684),w=a(9300),T=a(5698),U=a(7579),S=a(6063);class D extends U.x{constructor(o=1/0,e=1/0,t=S.l){super(),this._bufferSize=o,this._windowTime=e,this._timestampProvider=t,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=e===1/0,this._bufferSize=Math.max(1,o),this._windowTime=Math.max(1,e)}next(o){const{isStopped:e,_buffer:t,_infiniteTimeWindow:i,_timestampProvider:r,_windowTime:l}=this;e||(t.push(o),!i&&t.push(r.now()+l)),this._trimBuffer(),super.next(o)}_subscribe(o){this._throwIfClosed(),this._trimBuffer();const e=this._innerSubscribe(o),{_infiniteTimeWindow:t,_buffer:i}=this,r=i.slice();for(let l=0;l<r.length&&!o.closed;l+=t?1:2)o.next(r[l]);return this._checkFinalizedStatuses(o),e}_trimBuffer(){const{_bufferSize:o,_timestampProvider:e,_buffer:t,_infiniteTimeWindow:i}=this,r=(i?1:2)*o;if(o<1/0&&r<t.length&&t.splice(0,t.length-r),!i){const l=e.now();let c=0;for(let u=1;u<t.length&&t[u]<=l;u+=2)c=u;c&&t.splice(0,c+1)}}}class A extends U.x{constructor(){super(...arguments),this._value=null,this._hasValue=!1,this._isComplete=!1}_checkFinalizedStatuses(o){const{hasError:e,_hasValue:t,_value:i,thrownError:r,isStopped:l,_isComplete:c}=this;e?o.error(r):(l||c)&&(t&&o.next(i),o.complete())}next(o){this.isStopped||(this._value=o,this._hasValue=!0)}complete(){const{_hasValue:o,_value:e,_isComplete:t}=this;t||(this._isComplete=!0,o&&super.next(e),super.complete())}}var M=a(9751),L=a(576);class C{constructor(){}loadScript(o,e,t,i=null){if(typeof document<"u"&&!document.getElementById(o)){let r=document.createElement("script");r.async=!0,r.src=e,r.onload=t,i||(i=document.head),i.appendChild(r)}}}class z{}const x={oneTapEnabled:!0};let m=(()=>{class s extends C{constructor(e,t){super(),this.clientId=e,this.initOptions=t,this.changeUser=new n.vpe,this._socialUser=new y.X(null),this._accessToken=new y.X(null),this._receivedAccessToken=new n.vpe,this.initOptions={...x,...this.initOptions},this._socialUser.pipe((0,b.T)(1)).subscribe(this.changeUser),this._accessToken.pipe((0,b.T)(1)).subscribe(this._receivedAccessToken)}initialize(e){return new Promise((t,i)=>{try{this.loadScript(s.PROVIDER_ID,"https://accounts.google.com/gsi/client",()=>{if(google.accounts.id.initialize({client_id:this.clientId,auto_select:e,callback:({credential:r})=>{const l=this.createSocialUser(r);this._socialUser.next(l)},prompt_parent_id:this.initOptions?.prompt_parent_id,itp_support:this.initOptions.oneTapEnabled}),this.initOptions.oneTapEnabled&&this._socialUser.pipe((0,w.h)(r=>null===r)).subscribe(()=>google.accounts.id.prompt(console.debug)),this.initOptions.scopes){const r=this.initOptions.scopes instanceof Array?this.initOptions.scopes.filter(l=>l).join(" "):this.initOptions.scopes;this._tokenClient=google.accounts.oauth2.initTokenClient({client_id:this.clientId,scope:r,callback:l=>{l.error?this._accessToken.error({code:l.error,description:l.error_description,uri:l.error_uri}):this._accessToken.next(l.access_token)}})}t()})}catch(r){i(r)}})}getLoginStatus(){return new Promise((e,t)=>{this._socialUser.value?e(this._socialUser.value):t(`No user is currently logged in with ${s.PROVIDER_ID}`)})}refreshToken(){return new Promise((e,t)=>{google.accounts.id.revoke(this._socialUser.value.id,i=>{i.error?t(i.error):e(this._socialUser.value)})})}getAccessToken(){return new Promise((e,t)=>{this._tokenClient?(this._tokenClient.requestAccessToken({hint:this._socialUser.value?.email}),this._receivedAccessToken.pipe((0,T.q)(1)).subscribe(e)):t(this._socialUser.value?"No token client was instantiated, you should specify some scopes.":"You should be logged-in first.")})}revokeAccessToken(){return new Promise((e,t)=>{this._tokenClient?this._accessToken.value?google.accounts.oauth2.revoke(this._accessToken.value,()=>{this._accessToken.next(null),e()}):t("No access token to revoke"):t("No token client was instantiated, you should specify some scopes.")})}signIn(){return Promise.reject('You should not call this method directly for Google, use "<asl-google-signin-button>" wrapper or generate the button yourself with "google.accounts.id.renderButton()" (https://developers.google.com/identity/gsi/web/guides/display-button#javascript)')}signOut(){var e=this;return(0,O.Z)(function*(){google.accounts.id.disableAutoSelect(),e._socialUser.next(null)})()}createSocialUser(e){const t=new z;t.idToken=e;const i=this.decodeJwt(e);return t.id=i.sub,t.name=i.name,t.email=i.email,t.photoUrl=i.picture,t.firstName=i.given_name,t.lastName=i.family_name,t}decodeJwt(e){const i=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(window.atob(i).split("").map(function(l){return"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(r)}}return s.PROVIDER_ID="GOOGLE",s})(),v=(()=>{class s{constructor(e,t,i){this._ngZone=t,this._injector=i,this.providers=new Map,this.autoLogin=!1,this._user=null,this._authState=new D(1),this.initialized=!1,this._initState=new A,e instanceof Promise?e.then(r=>{this.initialize(r)}):this.initialize(e)}get authState(){return this._authState.asObservable()}get initState(){return this._initState.asObservable()}initialize(e){this.autoLogin=void 0!==e.autoLogin&&e.autoLogin;const{onError:t=console.error}=e;e.providers.forEach(i=>{this.providers.set(i.id,"prototype"in i.provider?this._injector.get(i.provider):i.provider)}),Promise.all(Array.from(this.providers.values()).map(i=>i.initialize(this.autoLogin))).then(()=>{if(this.autoLogin){const i=[];let r=!1;this.providers.forEach((l,c)=>{const u=l.getLoginStatus();i.push(u),u.then(E=>{this.setUser(E,c),r=!0}).catch(console.debug)}),Promise.all(i).catch(()=>{r||(this._user=null,this._authState.next(null))})}this.providers.forEach((i,r)=>{(function N(s){return!!s&&(s instanceof M.y||(0,L.m)(s.lift)&&(0,L.m)(s.subscribe))})(i.changeUser)&&i.changeUser.subscribe(l=>{this._ngZone.run(()=>{this.setUser(l,r)})})})}).catch(i=>{t(i)}).finally(()=>{this.initialized=!0,this._initState.next(this.initialized),this._initState.complete()})}getAccessToken(e){var t=this;return(0,O.Z)(function*(){const i=t.providers.get(e);if(!t.initialized)throw s.ERR_NOT_INITIALIZED;if(!i)throw s.ERR_LOGIN_PROVIDER_NOT_FOUND;if(!(i instanceof m))throw s.ERR_NOT_SUPPORTED_FOR_ACCESS_TOKEN;return yield i.getAccessToken()})()}refreshAuthToken(e){return new Promise((t,i)=>{if(this.initialized){const r=this.providers.get(e);r?"function"!=typeof r.refreshToken?i(s.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN):r.refreshToken().then(l=>{this.setUser(l,e),t()}).catch(l=>{i(l)}):i(s.ERR_LOGIN_PROVIDER_NOT_FOUND)}else i(s.ERR_NOT_INITIALIZED)})}refreshAccessToken(e){return new Promise((t,i)=>{if(this.initialized)if(e!==m.PROVIDER_ID)i(s.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN);else{const r=this.providers.get(e);r instanceof m?r.revokeAccessToken().then(t).catch(i):i(s.ERR_LOGIN_PROVIDER_NOT_FOUND)}else i(s.ERR_NOT_INITIALIZED)})}signIn(e,t){return new Promise((i,r)=>{if(this.initialized){let l=this.providers.get(e);l?l.signIn(t).then(c=>{this.setUser(c,e),i(c)}).catch(c=>{r(c)}):r(s.ERR_LOGIN_PROVIDER_NOT_FOUND)}else r(s.ERR_NOT_INITIALIZED)})}signOut(e=!1){return new Promise((t,i)=>{if(this.initialized)if(this._user){let l=this.providers.get(this._user.provider);l?l.signOut(e).then(()=>{t(),this.setUser(null)}).catch(c=>{i(c)}):i(s.ERR_LOGIN_PROVIDER_NOT_FOUND)}else i(s.ERR_NOT_LOGGED_IN);else i(s.ERR_NOT_INITIALIZED)})}setUser(e,t){e&&t&&(e.provider=t),this._user=e,this._authState.next(e)}}return s.ERR_LOGIN_PROVIDER_NOT_FOUND="Login provider not found",s.ERR_NOT_LOGGED_IN="Not logged in",s.ERR_NOT_INITIALIZED="Login providers not ready yet. Are there errors on your console?",s.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN="Chosen login provider is not supported for refreshing a token",s.ERR_NOT_SUPPORTED_FOR_ACCESS_TOKEN="Chosen login provider is not supported for getting an access token",s.\u0275fac=function(e){return new(e||s)(n.LFG("SocialAuthServiceConfig"),n.LFG(n.R0b),n.LFG(n.zs3))},s.\u0275prov=n.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})(),F=(()=>{class s{constructor(e,t){this.type="icon",this.size="medium",this.text="signin_with",this.shape="rectangular",this.theme="outline",this.logo_alignment="left",this.width="",this.locale="",t.initState.pipe((0,T.q)(1)).subscribe(()=>{Promise.resolve(this.locale).then(i=>{console.log("value",i)}),Promise.resolve(this.width).then(i=>{i>"400"||i<"200"&&""!=i?Promise.reject("Please note .. max-width 400 , min-width 200 (https://developers.google.com/identity/gsi/web/tools/configurator)"):google.accounts.id.renderButton(e.nativeElement,{type:this.type,size:this.size,text:this.text,width:this.width,shape:this.shape,theme:this.theme,logo_alignment:this.logo_alignment,locale:this.locale})})})}}return s.\u0275fac=function(e){return new(e||s)(n.Y36(n.SBq),n.Y36(v))},s.\u0275dir=n.lG2({type:s,selectors:[["asl-google-signin-button"]],inputs:{type:"type",size:"size",text:"text",shape:"shape",theme:"theme",logo_alignment:"logo_alignment",width:"width",locale:"locale"}}),s})(),j=(()=>{class s{constructor(e){if(e)throw new Error("SocialLoginModule is already loaded. Import it in the AppModule only")}static initialize(e){return{ngModule:s,providers:[v,{provide:"SocialAuthServiceConfig",useValue:e}]}}}return s.\u0275fac=function(e){return new(e||s)(n.LFG(s,12))},s.\u0275mod=n.oAB({type:s}),s.\u0275inj=n.cJS({providers:[v],imports:[P.ez]}),s})();var R=a(9197),_=a(529),V=a(1436);class h{constructor(o){this.httpClient=o,this.urlBase=V.N.apiUrl}getUserIcall(o){let e=new _.LE;return e=e.append("email",o),this.httpClient.get(`${this.urlBase}user`,{params:e})}createUserIcall(o){console.log(o);let e=new _.LE({fromObject:{email:o.email,name:o.name,imageFile:o.photoUrl}});return this.httpClient.post(`${this.urlBase}user`,e)}}h.\u0275fac=function(o){return new(o||h)(n.LFG(_.eN))},h.\u0275prov=n.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"});var k=a(7392);class f{constructor(o,e,t){this.socialAuthService=o,this.router=e,this.userService=t,this.form=new g.cw({})}ngOnInit(){this.authSession()}authSession(){var o=this;return(0,O.Z)(function*(){o.socialAuthService.authState.subscribe(e=>{e&&o.userService.getUserIcall(e.email).subscribe(t=>{if(t.error||!t.message.length)o.createUser(e);else{const[i]=t.message;o.setSessionLogin(e,i)}})})})()}createUser(o){this.userService.createUserIcall(o).subscribe(e=>{e.error||this.setSessionLogin(o,e.message)})}setSessionLogin(o,e){localStorage.setItem("token-session",btoa(o.idToken)),localStorage.setItem("user-session",btoa(JSON.stringify(e))),this.router.navigateByUrl("/")}}f.\u0275fac=function(o){return new(o||f)(n.Y36(v),n.Y36(R.F0),n.Y36(h))},f.\u0275cmp=n.Xpm({type:f,selectors:[["app-login"]],decls:28,vars:1,consts:[[1,"page-login"],[1,"main-content"],[1,"container-title-return"],[1,"return"],[1,"blue-icon"],[1,"block-title"],[1,"h3","mb-3","font-weight-normal"],["novalidate","",1,"form-signin",3,"formGroup"],["for","inputEmail",1,"sr-only"],["type","email","id","inputEmail","placeholder","Email address","required","","autofocus","",1,"form-control"],["for","inputPassword",1,"sr-only"],["type","password","id","inputPassword","placeholder","Password","required","",1,"form-control"],[1,"checkbox","mb-3"],["type","checkbox","value","remember-me"],["type","submit",1,"btn","btn-lg","btn-primary","btn-block"],["type","standard","size","medium","shape","circle",1,"google"],[1,"mt-5","mb-3","text-muted"]],template:function(o,e){1&o&&(n.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"a",3)(4,"mat-icon",4),n._uU(5,"keyboard_backspace"),n.qZA(),n._uU(6," Atras"),n.qZA()(),n.TgZ(7,"div",5)(8,"h1",6),n._uU(9,"Icall"),n.qZA()(),n.TgZ(10,"form",7)(11,"h3",6),n._uU(12,"Please sign in"),n.qZA(),n.TgZ(13,"label",8),n._uU(14,"Email address"),n.qZA(),n._UZ(15,"input",9),n.TgZ(16,"label",10),n._uU(17,"Password"),n.qZA(),n._UZ(18,"input",11),n.TgZ(19,"div",12)(20,"label"),n._UZ(21,"input",13),n._uU(22," Remember me "),n.qZA()(),n.TgZ(23,"button",14),n._uU(24,"Sign in"),n.qZA(),n._UZ(25,"asl-google-signin-button",15),n.TgZ(26,"p",16),n._uU(27,"\xa9 2017-2018"),n.qZA()()()()),2&o&&(n.xp6(10),n.Q6J("formGroup",e.form))},dependencies:[g._Y,g.JL,g.sg,F,k.Hw],styles:[".page-login[_ngcontent-%COMP%]{height:100svh}.block-title[_ngcontent-%COMP%]{margin:auto;text-align:center}.block-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:40px;font-weight:700px;line-height:48px}.container-title-return[_ngcontent-%COMP%]   .blue-icon[_ngcontent-%COMP%]{color:#377dff;margin-right:5px}.container-title-return[_ngcontent-%COMP%]   .return[_ngcontent-%COMP%]{display:flex;align-items:center;color:#377dff;text-decoration:none}.form-signin[_ngcontent-%COMP%]{width:100%;max-width:330px;padding:15px;margin:0 auto;text-align:center}.form-signin[_ngcontent-%COMP%]   .google[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;margin-top:10px}.form-signin[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{font-weight:400}.form-signin[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{position:relative;box-sizing:border-box;height:auto;padding:10px;font-size:16px}.form-signin[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{z-index:2}.form-signin[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%]{margin-bottom:-1px;border-bottom-right-radius:0;border-bottom-left-radius:0}.form-signin[_ngcontent-%COMP%]   input[type=password][_ngcontent-%COMP%]{margin-bottom:10px;border-top-left-radius:0;border-top-right-radius:0}label[_ngcontent-%COMP%]{display:none}.btn-block[_ngcontent-%COMP%]{display:block;width:100%}"]});var G=a(4144),B=a(7676);class p{constructor(o){this.router=o}canActivate(o,e){return!0}isLoggedIn(){return!localStorage.getItem("token-session")}}p.\u0275fac=function(o){return new(o||p)(n.LFG(R.F0))},p.\u0275prov=n.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"});class d{}d.\u0275fac=function(o){return new(o||d)},d.\u0275mod=n.oAB({type:d}),d.\u0275inj=n.cJS({providers:[{provide:"SocialAuthServiceConfig",useValue:{autoLogin:!0,providers:[{id:m.PROVIDER_ID,provider:new m("711389757233-2qma15neni4dcdu3mlkdt8crlgr0foup.apps.googleusercontent.com",{scopes:["email"]})}]}},h],imports:[P.ez,R.Bz.forChild([{path:"",component:f,canLoad:[p]}]),G.c,B.lN,g.UX,j,_.JF,k.Ps]})}}]);