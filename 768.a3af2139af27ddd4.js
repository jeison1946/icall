"use strict";(self.webpackChunkicall=self.webpackChunkicall||[]).push([[768],{6768:(B,I,l)=>{l.r(I),l.d(I,{LoginModule:()=>d});var P=l(6895),O=l(5861),g=l(4006),r=l(4650),y=l(1135),T=l(5684),E=l(9300),L=l(5698),b=l(7579),w=l(6063);class S extends b.x{constructor(o=1/0,e=1/0,t=w.l){super(),this._bufferSize=o,this._windowTime=e,this._timestampProvider=t,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=e===1/0,this._bufferSize=Math.max(1,o),this._windowTime=Math.max(1,e)}next(o){const{isStopped:e,_buffer:t,_infiniteTimeWindow:s,_timestampProvider:n,_windowTime:a}=this;e||(t.push(o),!s&&t.push(n.now()+a)),this._trimBuffer(),super.next(o)}_subscribe(o){this._throwIfClosed(),this._trimBuffer();const e=this._innerSubscribe(o),{_infiniteTimeWindow:t,_buffer:s}=this,n=s.slice();for(let a=0;a<n.length&&!o.closed;a+=t?1:2)o.next(n[a]);return this._checkFinalizedStatuses(o),e}_trimBuffer(){const{_bufferSize:o,_timestampProvider:e,_buffer:t,_infiniteTimeWindow:s}=this,n=(s?1:2)*o;if(o<1/0&&n<t.length&&t.splice(0,t.length-n),!s){const a=e.now();let c=0;for(let u=1;u<t.length&&t[u]<=a;u+=2)c=u;c&&t.splice(0,c+1)}}}class D extends b.x{constructor(){super(...arguments),this._value=null,this._hasValue=!1,this._isComplete=!1}_checkFinalizedStatuses(o){const{hasError:e,_hasValue:t,_value:s,thrownError:n,isStopped:a,_isComplete:c}=this;e?o.error(n):(a||c)&&(t&&o.next(s),o.complete())}next(o){this.isStopped||(this._value=o,this._hasValue=!0)}complete(){const{_hasValue:o,_value:e,_isComplete:t}=this;t||(this._isComplete=!0,o&&super.next(e),super.complete())}}var N=l(9751),U=l(576);class z{constructor(){}loadScript(o,e,t,s=null){if(typeof document<"u"&&!document.getElementById(o)){let n=document.createElement("script");n.async=!0,n.src=e,n.onload=t,s||(s=document.head),s.appendChild(n)}}}class M{}const C={oneTapEnabled:!0};let m=(()=>{class i extends z{constructor(e,t){super(),this.clientId=e,this.initOptions=t,this.changeUser=new r.vpe,this._socialUser=new y.X(null),this._accessToken=new y.X(null),this._receivedAccessToken=new r.vpe,this.initOptions={...C,...this.initOptions},this._socialUser.pipe((0,T.T)(1)).subscribe(this.changeUser),this._accessToken.pipe((0,T.T)(1)).subscribe(this._receivedAccessToken)}initialize(e){return new Promise((t,s)=>{try{this.loadScript(i.PROVIDER_ID,"https://accounts.google.com/gsi/client",()=>{if(google.accounts.id.initialize({client_id:this.clientId,auto_select:e,callback:({credential:n})=>{const a=this.createSocialUser(n);this._socialUser.next(a)},prompt_parent_id:this.initOptions?.prompt_parent_id,itp_support:this.initOptions.oneTapEnabled}),this.initOptions.oneTapEnabled&&this._socialUser.pipe((0,E.h)(n=>null===n)).subscribe(()=>google.accounts.id.prompt(console.debug)),this.initOptions.scopes){const n=this.initOptions.scopes instanceof Array?this.initOptions.scopes.filter(a=>a).join(" "):this.initOptions.scopes;this._tokenClient=google.accounts.oauth2.initTokenClient({client_id:this.clientId,scope:n,callback:a=>{a.error?this._accessToken.error({code:a.error,description:a.error_description,uri:a.error_uri}):this._accessToken.next(a.access_token)}})}t()})}catch(n){s(n)}})}getLoginStatus(){return new Promise((e,t)=>{this._socialUser.value?e(this._socialUser.value):t(`No user is currently logged in with ${i.PROVIDER_ID}`)})}refreshToken(){return new Promise((e,t)=>{google.accounts.id.revoke(this._socialUser.value.id,s=>{s.error?t(s.error):e(this._socialUser.value)})})}getAccessToken(){return new Promise((e,t)=>{this._tokenClient?(this._tokenClient.requestAccessToken({hint:this._socialUser.value?.email}),this._receivedAccessToken.pipe((0,L.q)(1)).subscribe(e)):t(this._socialUser.value?"No token client was instantiated, you should specify some scopes.":"You should be logged-in first.")})}revokeAccessToken(){return new Promise((e,t)=>{this._tokenClient?this._accessToken.value?google.accounts.oauth2.revoke(this._accessToken.value,()=>{this._accessToken.next(null),e()}):t("No access token to revoke"):t("No token client was instantiated, you should specify some scopes.")})}signIn(){return Promise.reject('You should not call this method directly for Google, use "<asl-google-signin-button>" wrapper or generate the button yourself with "google.accounts.id.renderButton()" (https://developers.google.com/identity/gsi/web/guides/display-button#javascript)')}signOut(){var e=this;return(0,O.Z)(function*(){google.accounts.id.disableAutoSelect(),e._socialUser.next(null)})()}createSocialUser(e){const t=new M;t.idToken=e;const s=this.decodeJwt(e);return t.id=s.sub,t.name=s.name,t.email=s.email,t.photoUrl=s.picture,t.firstName=s.given_name,t.lastName=s.family_name,t}decodeJwt(e){const s=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(window.atob(s).split("").map(function(a){return"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}}return i.PROVIDER_ID="GOOGLE",i})(),v=(()=>{class i{constructor(e,t,s){this._ngZone=t,this._injector=s,this.providers=new Map,this.autoLogin=!1,this._user=null,this._authState=new S(1),this.initialized=!1,this._initState=new D,e instanceof Promise?e.then(n=>{this.initialize(n)}):this.initialize(e)}get authState(){return this._authState.asObservable()}get initState(){return this._initState.asObservable()}initialize(e){this.autoLogin=void 0!==e.autoLogin&&e.autoLogin;const{onError:t=console.error}=e;e.providers.forEach(s=>{this.providers.set(s.id,"prototype"in s.provider?this._injector.get(s.provider):s.provider)}),Promise.all(Array.from(this.providers.values()).map(s=>s.initialize(this.autoLogin))).then(()=>{if(this.autoLogin){const s=[];let n=!1;this.providers.forEach((a,c)=>{const u=a.getLoginStatus();s.push(u),u.then(k=>{this.setUser(k,c),n=!0}).catch(console.debug)}),Promise.all(s).catch(()=>{n||(this._user=null,this._authState.next(null))})}this.providers.forEach((s,n)=>{(function A(i){return!!i&&(i instanceof N.y||(0,U.m)(i.lift)&&(0,U.m)(i.subscribe))})(s.changeUser)&&s.changeUser.subscribe(a=>{this._ngZone.run(()=>{this.setUser(a,n)})})})}).catch(s=>{t(s)}).finally(()=>{this.initialized=!0,this._initState.next(this.initialized),this._initState.complete()})}getAccessToken(e){var t=this;return(0,O.Z)(function*(){const s=t.providers.get(e);if(!t.initialized)throw i.ERR_NOT_INITIALIZED;if(!s)throw i.ERR_LOGIN_PROVIDER_NOT_FOUND;if(!(s instanceof m))throw i.ERR_NOT_SUPPORTED_FOR_ACCESS_TOKEN;return yield s.getAccessToken()})()}refreshAuthToken(e){return new Promise((t,s)=>{if(this.initialized){const n=this.providers.get(e);n?"function"!=typeof n.refreshToken?s(i.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN):n.refreshToken().then(a=>{this.setUser(a,e),t()}).catch(a=>{s(a)}):s(i.ERR_LOGIN_PROVIDER_NOT_FOUND)}else s(i.ERR_NOT_INITIALIZED)})}refreshAccessToken(e){return new Promise((t,s)=>{if(this.initialized)if(e!==m.PROVIDER_ID)s(i.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN);else{const n=this.providers.get(e);n instanceof m?n.revokeAccessToken().then(t).catch(s):s(i.ERR_LOGIN_PROVIDER_NOT_FOUND)}else s(i.ERR_NOT_INITIALIZED)})}signIn(e,t){return new Promise((s,n)=>{if(this.initialized){let a=this.providers.get(e);a?a.signIn(t).then(c=>{this.setUser(c,e),s(c)}).catch(c=>{n(c)}):n(i.ERR_LOGIN_PROVIDER_NOT_FOUND)}else n(i.ERR_NOT_INITIALIZED)})}signOut(e=!1){return new Promise((t,s)=>{if(this.initialized)if(this._user){let a=this.providers.get(this._user.provider);a?a.signOut(e).then(()=>{t(),this.setUser(null)}).catch(c=>{s(c)}):s(i.ERR_LOGIN_PROVIDER_NOT_FOUND)}else s(i.ERR_NOT_LOGGED_IN);else s(i.ERR_NOT_INITIALIZED)})}setUser(e,t){e&&t&&(e.provider=t),this._user=e,this._authState.next(e)}}return i.ERR_LOGIN_PROVIDER_NOT_FOUND="Login provider not found",i.ERR_NOT_LOGGED_IN="Not logged in",i.ERR_NOT_INITIALIZED="Login providers not ready yet. Are there errors on your console?",i.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN="Chosen login provider is not supported for refreshing a token",i.ERR_NOT_SUPPORTED_FOR_ACCESS_TOKEN="Chosen login provider is not supported for getting an access token",i.\u0275fac=function(e){return new(e||i)(r.LFG("SocialAuthServiceConfig"),r.LFG(r.R0b),r.LFG(r.zs3))},i.\u0275prov=r.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),x=(()=>{class i{constructor(e,t){this.type="icon",this.size="medium",this.text="signin_with",this.shape="rectangular",this.theme="outline",this.logo_alignment="left",this.width="",this.locale="",t.initState.pipe((0,L.q)(1)).subscribe(()=>{Promise.resolve(this.locale).then(s=>{console.log("value",s)}),Promise.resolve(this.width).then(s=>{s>"400"||s<"200"&&""!=s?Promise.reject("Please note .. max-width 400 , min-width 200 (https://developers.google.com/identity/gsi/web/tools/configurator)"):google.accounts.id.renderButton(e.nativeElement,{type:this.type,size:this.size,text:this.text,width:this.width,shape:this.shape,theme:this.theme,logo_alignment:this.logo_alignment,locale:this.locale})})})}}return i.\u0275fac=function(e){return new(e||i)(r.Y36(r.SBq),r.Y36(v))},i.\u0275dir=r.lG2({type:i,selectors:[["asl-google-signin-button"]],inputs:{type:"type",size:"size",text:"text",shape:"shape",theme:"theme",logo_alignment:"logo_alignment",width:"width",locale:"locale"}}),i})(),F=(()=>{class i{constructor(e){if(e)throw new Error("SocialLoginModule is already loaded. Import it in the AppModule only")}static initialize(e){return{ngModule:i,providers:[v,{provide:"SocialAuthServiceConfig",useValue:e}]}}}return i.\u0275fac=function(e){return new(e||i)(r.LFG(i,12))},i.\u0275mod=r.oAB({type:i}),i.\u0275inj=r.cJS({providers:[v],imports:[P.ez]}),i})();var R=l(9197),_=l(529),j=l(1436);class h{constructor(o){this.httpClient=o,this.urlBase=j.N.apiUrl}getUserIcall(o){let e=new _.LE;return e=e.append("email",o),this.httpClient.get(`${this.urlBase}user`,{params:e})}createUserIcall(o){let e=new _.LE({fromObject:{name:o.name,email:o.email}});return this.httpClient.post(`${this.urlBase}user`,e)}}h.\u0275fac=function(o){return new(o||h)(r.LFG(_.eN))},h.\u0275prov=r.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"});class f{constructor(o,e,t){this.socialAuthService=o,this.router=e,this.userService=t,this.form=new g.cw({})}ngOnInit(){this.authSession()}authSession(){var o=this;return(0,O.Z)(function*(){o.socialAuthService.authState.subscribe(e=>{e&&o.userService.getUserIcall(e.email).subscribe(t=>{if(t.error||!t.message.length)o.createUser(e);else{const[s]=t.message;o.setSessionLogin(e,s)}})})})()}createUser(o){this.userService.createUserIcall(o).subscribe(e=>{e.error||this.setSessionLogin(o,e.message)})}setSessionLogin(o,e){localStorage.setItem("token-session",btoa(o.idToken)),localStorage.setItem("user-session",btoa(JSON.stringify(e))),this.router.navigateByUrl("/")}}f.\u0275fac=function(o){return new(o||f)(r.Y36(v),r.Y36(R.F0),r.Y36(h))},f.\u0275cmp=r.Xpm({type:f,selectors:[["app-login"]],decls:19,vars:1,consts:[[1,"main-center","text-center"],["novalidate","",1,"form-signin",3,"formGroup"],[1,"h3","mb-3","font-weight-normal"],["for","inputEmail",1,"sr-only"],["type","email","id","inputEmail","placeholder","Email address","required","","autofocus","",1,"form-control"],["for","inputPassword",1,"sr-only"],["type","password","id","inputPassword","placeholder","Password","required","",1,"form-control"],[1,"checkbox","mb-3"],["type","checkbox","value","remember-me"],["type","submit",1,"btn","btn-lg","btn-primary","btn-block"],["type","standard","size","medium","shape","circle",1,"google"],[1,"mt-5","mb-3","text-muted"]],template:function(o,e){1&o&&(r.TgZ(0,"div",0)(1,"form",1)(2,"h1",2),r._uU(3,"Please sign in"),r.qZA(),r.TgZ(4,"label",3),r._uU(5,"Email address"),r.qZA(),r._UZ(6,"input",4),r.TgZ(7,"label",5),r._uU(8,"Password"),r.qZA(),r._UZ(9,"input",6),r.TgZ(10,"div",7)(11,"label"),r._UZ(12,"input",8),r._uU(13," Remember me "),r.qZA()(),r.TgZ(14,"button",9),r._uU(15,"Sign in"),r.qZA(),r._UZ(16,"asl-google-signin-button",10),r.TgZ(17,"p",11),r._uU(18,"\xa9 2017-2018"),r.qZA()()()),2&o&&(r.xp6(1),r.Q6J("formGroup",e.form))},dependencies:[g._Y,g.JL,g.sg,x],styles:[".main-center[_ngcontent-%COMP%]{height:100vh;display:flex;align-items:center;justify-content:center}.form-signin[_ngcontent-%COMP%]{width:100%;max-width:330px;padding:15px;margin:0 auto}.form-signin[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{font-weight:400}.form-signin[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{position:relative;box-sizing:border-box;height:auto;padding:10px;font-size:16px}.form-signin[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{z-index:2}.form-signin[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%]{margin-bottom:-1px;border-bottom-right-radius:0;border-bottom-left-radius:0}.form-signin[_ngcontent-%COMP%]   input[type=password][_ngcontent-%COMP%]{margin-bottom:10px;border-top-left-radius:0;border-top-right-radius:0}label[_ngcontent-%COMP%]{display:none}.btn-block[_ngcontent-%COMP%]{display:block;width:100%}"]});var V=l(4144),G=l(7676);class p{constructor(o){this.router=o}canActivate(o,e){return!0}isLoggedIn(){return!localStorage.getItem("token-session")}}p.\u0275fac=function(o){return new(o||p)(r.LFG(R.F0))},p.\u0275prov=r.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"});class d{}d.\u0275fac=function(o){return new(o||d)},d.\u0275mod=r.oAB({type:d}),d.\u0275inj=r.cJS({providers:[{provide:"SocialAuthServiceConfig",useValue:{autoLogin:!0,providers:[{id:m.PROVIDER_ID,provider:new m("711389757233-2qma15neni4dcdu3mlkdt8crlgr0foup.apps.googleusercontent.com",{scopes:["email"]})}]}},h],imports:[P.ez,R.Bz.forChild([{path:"",component:f,canLoad:[p]}]),V.c,G.lN,g.UX,F,_.JF]})}}]);